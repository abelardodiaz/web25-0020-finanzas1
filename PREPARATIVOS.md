python -m venv venv  

.\venv\Scripts\activate      

pip install --upgrade pip


pip install Django django-environ mariadb mysqlclient 

# django-environ está diseñado específicamente para Django y ofrece

# Tipado automático: Convierte automáticamente los valores de entorno al tipo correcto (booleanos, enteros, listas)
# DEBUG = env.bool('DEBUG')  # Convierte 'True' a True (booleano)
# PORT = env.int('DB_PORT')  # Convierte '3306' a 3306 (entero)

# Soporte para URLs complejas:
# DATABASE_URL = env.db_url('DATABASE_URL')  # Parsea URLs como postgres://user:pass@host:port/dbname
# CACHE_URL = env.cache_url('CACHE_URL')

# Validación de variables
# SECRET_KEY = env.str('SECRET_KEY')  # Falla si no existe
# OPTIONAL_SETTING = env.str('OPTIONAL_SETTING', default='valor_por_defecto')

# Soporte para archivos .env múltiples:
# env.read_env('.env.production')  # Puedes tener diferentes configs por entorno

# Soporte nativo para configuraciones comunes de Django
# # Configuración de base de datos con una sola línea
# DATABASES = {
#    'default': env.db(),  # Lee DATABASE_URL del .env
# }

# Configuración de email
# EMAIL_CONFIG = env.email_url('EMAIL_URL')
# vars().update(EMAIL_CONFIG)

django-admin startproject config .

python manage.py startapp core


# borrar BD y usuario si existia antes
DROP DATABASE web250020_finanzas;
DROP USER 'web250020_user'@'%';
FLUSH PRIVILEGES;

# crear BD y usuario
CREATE DATABASE web250020_finanzas CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'web250020_user'@'%' IDENTIFIED BY 'xjdldjfRDDs#4$TR#x';
GRANT ALL PRIVILEGES ON web250020_finanzas.* TO 'web250020_user'@'%';
FLUSH PRIVILEGES;


# config/settings.py
# file: config/settings.py
"""
Django settings for config project.
Generated by 'django-admin startproject' using Django 5.2.3.
"""

from pathlib import Path
import os
import environ

# Build paths
BASE_DIR = Path(__file__).resolve().parent.parent

# Inicializar environ - CON RUTA EXPLÍCITA
env = environ.Env()
env.read_env(os.path.join(BASE_DIR, '.env'))

# Security
SECRET_KEY = env('SECRET_KEY')
DEBUG = env('DEBUG', default=False)
ALLOWED_HOSTS = ['*']  # Agregado para permitir todos los hosts durante desarrollo

# Application definition
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'core.apps.CoreConfig', 
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'config.wsgi.application'

# Database
DATABASES = {
    'default': env.db(),  # Usa DATABASE_URL del .env
}
# configuracion especial para mariadb
DATABASES['default']['OPTIONS'] = {
    'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
    'charset': 'utf8mb4',
}

# Password validation
AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# Internationalization
LANGUAGE_CODE = 'es-MX'
TIME_ZONE = 'America/Mexico_City'  # CORREGIDO
USE_I18N = True
USE_TZ = True

# Static files
STATIC_URL = 'static/'
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'


## ####################
## crear fichero .ENV
# Django
DJANGO_SECRET_KEY="xjDggjdDXxf%6#4dFTTxQsdG/xRM$x"
DEBUG=True


DATABASE_URL=mysql://web250020_user:xjdldjfRDDs%234$TR%23x@158.69.59.205:3306/web250020_finanzas

## ################################

## EMAIL_URL=smtp://tu_usuario:tu_password@smtp.tudominio.com:587/?tls=True
# Opciones comunes:

# smtp+ssl:// para conexiones SSL (puerto 465)

# consolemail:// para modo desarrollo (imprime emails en consola)

# dummymail:// para descartar emails

# ############################################################
# A V A N Z A D O....MULTIPLES EMAILS Y MULTILES bASES DE DATOS
# ############################################################

# Múltiples bases de datos
# DATABASES = {
#    'default': env.db(),
#    'replica': env.db('REPLICA_DATABASE_URL'),
# }

# Múltiples servicios de email
# EMAIL_BACKEND_CONFIG = env.email_url('EMAIL_BACKEND_URL')
# vars().update(EMAIL_BACKEND_CONFIG)

# Config adicional para mail de errores
# ERROR_EMAIL_CONFIG = env.email_url('ERROR_EMAIL_URL')

# checar si funciona la conexion a la BD
python manage.py check --database default



# PROBAR Email (en shell de Django):

# from django.core.mail import send_mail
# send_mail(
#    'Prueba django-environ',
#    '¡Funciona correctamente!',
#    'from@example.com',
#    ['to@example.com'],
#    fail_silently=False,
# )

# Cuando tengas caracteres especiales en contraseñas, usa esta tabla de codificación:

# Carácter	Código URL
# #	%23
# @	%40
# :	%3A
# /	%2F
# ?	%3F
# &	%26
# =	%3D
# %	%25
# espacio	%20

# core/models.py

from django.db import models

class ExampleModel(models.Model):
    name = models.CharField(max_length=100)
    description = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.name


python manage.py check --database default

python manage.py makemigrations

python manage.py migrate

python manage.py createsuperuser

python manage.py runserver

# Eliminar archivos de migraciones (no la carpeta)
rm core/migrations/0*.py

# Opcional: Limpiar la base de datos (si quieres empezar desde cero)
python manage.py flush 

# migrar solo la app core o todo segun sea el caso
python manage.py makemigrations core

python manage.py migrate core


